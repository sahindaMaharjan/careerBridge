@page
@model RegisterModel
@{
    ViewData["Title"] = "Register";
}

<link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/flatly/bootstrap.min.css" rel="stylesheet" />

<div class="container mt-5">
    <div class="row justify-content-center">
        <section class="col-md-6">
            <div class="card shadow-sm">
                <header class="card-header bg-primary text-white text-center">
                    <h3 class="mb-0">@ViewData["Title"]</h3>
                </header>
                <div class="card-body">
                    <form id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post" enctype="multipart/form-data" novalidate>
                        <div class="mb-4 text-center">
                            <span class="badge bg-secondary" id="stepIndicator">Step 1 of 2</span> <!-- Added id="stepIndicator" for JS update -->
                        </div>

                        <!-- Step 1: All fields except email/password/confirm password -->
                        <div id="step1">
                            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                            <div class="form-floating mb-3">
                                <input asp-for="Input.Fullname" class="form-control" placeholder="Fullname" />
                                <label asp-for="Input.Fullname">Full Name</label>
                                <span asp-validation-for="Input.Fullname" class="text-danger"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Input.Role" class="form-label">Role</label>
                                <select asp-for="Input.Role" class="form-select" id="roleSelect">
                                    <option value="" selected>-- choose one --</option>
                                    <option value="Student">Student</option>
                                    <option value="Employer">Employer</option>
                                    <option value="Mentor">Mentor</option>
                                </select>
                                <span asp-validation-for="Input.Role" class="text-danger"></span>
                            </div>

                            <div class="form-floating mb-3">
                                <input asp-for="Input.Phone" class="form-control" placeholder="Phone" />
                                <label asp-for="Input.Phone">Phone</label>
                                <span asp-validation-for="Input.Phone" class="text-danger"></span>
                            </div>

                            <!-- Student -->
                            <div class="form-floating mb-3 d-none" id="collegeField">
                                <input asp-for="Input.CollegeName" class="form-control" placeholder="College Name" />
                                <label asp-for="Input.CollegeName">College Name</label>
                                <span asp-validation-for="Input.CollegeName" class="text-danger"></span>
                            </div>

                            <!-- Employer -->
                            <div class="form-floating mb-3 d-none" id="businessCer">
                                <input asp-for="Input.BusinessCertificate" class="form-control" placeholder="Business Certificate" />
                                <label asp-for="Input.BusinessCertificate">Business Certificate</label>
                                <span asp-validation-for="Input.BusinessCertificate" class="text-danger"></span>
                            </div>

                            <!-- Mentor -->
                            <div class="form-floating mb-3 d-none" id="experienceCer">
                                <input asp-for="Input.ExperienceCertificate" class="form-control" placeholder="Experience Certificate" />
                                <label asp-for="Input.ExperienceCertificate">Experience Certificate</label>
                                <span asp-validation-for="Input.ExperienceCertificate" class="text-danger"></span>
                            </div>

                            <div class="form-floating mb-3 d-none" id="expertiseField">
                                <input asp-for="Input.ExpertiseArea" class="form-control" placeholder="Expertise Area" />
                                <label asp-for="Input.ExpertiseArea">Expertise</label>
                                <span asp-validation-for="Input.ExpertiseArea" class="text-danger"></span>
                            </div>

                            <button type="button" class="btn btn-info px-4 text-white w-100" onclick="goToStep2()">Next</button>
                        </div>

                        <!-- Step 2: Only Email, Password, Confirm Password -->
                        <div id="step2" style="display: none;">
                            <div class="form-floating mb-3">
                                <input asp-for="Input.Email" class="form-control" placeholder="Email" />
                                <label asp-for="Input.Email">Email</label>
                                <span asp-validation-for="Input.Email" class="text-danger"></span>
                            </div>

                            <div class="form-floating mb-3">
                                <input asp-for="Input.Password" type="password" class="form-control" placeholder="Password" />
                                <label asp-for="Input.Password">Password</label>
                                <span asp-validation-for="Input.Password" class="text-danger"></span>
                            </div>

                            <div class="form-floating mb-4">
                                <input asp-for="Input.ConfirmPassword" type="password" class="form-control" placeholder="Confirm Password" />
                                <label asp-for="Input.ConfirmPassword">Confirm Password</label>
                                <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-info px-4" onclick="backToStep1()">Back</button>
                                <button type="submit" class="btn btn-success px-4 text-white">Register</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function goToStep2() {
            const role = document.getElementById("roleSelect").value;
            if (!role) {
                alert("Please select a role.");
                return;
            }

            // Hide step 1 and show step 2
            document.getElementById("step1").style.display = "none";
            document.getElementById("step2").style.display = "block";

            // Update step indicator text
            document.getElementById("stepIndicator").innerText = "Step 2 of 2";

            // Removed toggleRoleFields(role) call here because role fields are all in step 1 now
        }

        function backToStep1() {
            // Show step 1 and hide step 2
            document.getElementById("step1").style.display = "block";
            document.getElementById("step2").style.display = "none";

            // Update step indicator text
            document.getElementById("stepIndicator").innerText = "Step 1 of 2";

            // Re-toggle role-related fields when going back to step 1
            const role = document.getElementById("roleSelect").value;
            if(role) {
                toggleRoleFields(role);
            }
        }

        function toggleRoleFields(role) {
            let studentField = document.getElementById("collegeField");
            let employerField = document.getElementById("businessCer");
            let mentorField = document.getElementById("experienceCer");
            let mentorField2 = document.getElementById("expertiseField");

            studentField.classList.add("d-none");
            employerField.classList.add("d-none");
            mentorField.classList.add("d-none");
            mentorField2.classList.add("d-none");

            if (role === "Student") {
                studentField.classList.remove("d-none");
            } else if (role === "Employer") {
                employerField.classList.remove("d-none");
            } else if (role === "Mentor") {
                mentorField.classList.remove("d-none");
                mentorField2.classList.remove("d-none");
            }
        }

        // Added event listener on role select to toggle fields dynamically on step 1
        document.getElementById("roleSelect").addEventListener("change", function() {
            toggleRoleFields(this.value);
        });
    </script>
}
